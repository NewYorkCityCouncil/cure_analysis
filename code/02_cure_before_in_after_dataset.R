# run 00_read_data.Rmd
# read in shootings data
cure_data <- read.csv("data/output/cure_data.csv") %>%
  select("precinct", "shootings_count", "shootings_per_person" , "year", "cure")
cure_data$cure<- as.character(cure_data$cure)

cure_data_lags <- cure_data %>%
  group_by(precinct) %>%
  filter(year == max(year)| # get the last year in cure
           year >= 2010 |# look behind two years from earliest program (2012)
            (cure != "0" & lead(cure) == "1") ) %>% # entering cure & look ahead
  group_by(precinct) %>%
  arrange(year, .by_group = TRUE) %>%
  mutate(pct_change = (shootings_per_person/lag(shootings_per_person) - 1) * 100)


write.csv(cure_data_lags, "../data/output/cure_before-in-after.csv", row.names = F)


########

cohort_shp <- programs_20 %>%
  select(1:6, 9:11)) %>%
  mutate(year = paste0(rep(20,nrow(.)),year),
         year = case_when(year=="20NA" ~ NA,
                          TRUE ~ year)) %>%
  left_join(cure_data, by= c('precinct', 'year')) %>%

